/*! InsightCharts 29-05-2014 */
function Group(a){this._data=a,this._cumulative=!1,this._valueAccessor=function(a){return a},this._orderFunction=function(a,b){return b.value-a.value},this._ordered=!1}function SimpleGroup(a){this._data=a,this._orderFunction=function(a,b){return b.values-a.values}}function NestedGroup(a,b){this._dimension=a,this._data=a.Dimension.bottom(1/0),this._nestFunction=b,this._nestedData=b.entries(this._data)}function Legend(a,b,c,d){BaseChart.call(this,a,b,c,d);this.dataset=function(){return this.group},this.init=function(){this.createChart();var a=this.chart.selectAll(".legend").data(this.dataset()).enter().append("g").attr("class","legend").attr("transform",function(a,b){return"translate(0,"+(20*b+5*b)+")"});a.append("rect").attr("x",0).attr("width",20).attr("height",20).attr("rx",10).attr("ry",10).style("fill",function(a){return a.color}),a.append("text").attr("x",25).attr("y",10).attr("dy",".35em").text(function(a){return a.label})},this.draw=function(){}}function DataTable(a,b,c,d){BaseChart.call(this,a,b,c,d);this._columns=[],this.chart=d3.select(this.element).append("table").attr("class","dataTable"),this.columns=function(a){return arguments.length?(this._columns=a,this):this._columns},this.init=function(){var a=this;this.header=this.chart.append("thead").append("tr"),this.header.append("th").attr("class","blank").html(""),this.header.selectAll("th.column").data(this._columns).enter().append("th").attr("class","column").html(function(a){return a.label}),this.rows=this.chart.selectAll("tr.datarow").data(this.dataset()),this.rows.enter().append("tr").attr("class","datarow"),this.rows.append("th").html(function(b){return a._keyAccessor(b)}),this.cells=this.rows.selectAll("td").data(function(b){return a._columns.map(function(a){return{column:a,value:a.formatter(a.calculation(b))}})});var b=this.cells.enter();b.append("td").html(function(a){return a.value})},this.draw=function(){var a=this;this.rows=this.chart.selectAll("tr.datarow").data(this.dataset()),this.rows.enter().append("tr").attr("class","datarow"),this.cells=this.rows.selectAll("td").data(function(b){return a._columns.map(function(a){return{column:a,value:a.formatter(a.calculation(b))}})}),this.cells.enter().append("td"),this.cells.html(function(a){return a.value}),this.cells.exit().remove(),this.rows.exit().remove()}}function BarChart(a,b,c,d){BaseChart.call(this,a,b,c,d),this.y2=null;var e=this;this.xFormatFunc=function(a){return a};var f=function(a){e.mouseOver(e,this,a)},g=function(a){e.mouseOut(e,this,a)};this.xAxisFormat=function(a){return this.xFormatFunc=a,this},this.calculateYPos=function(a,b){return b.yPos||(b.yPos=0),b.yPos+=a(b),b.yPos},this.calculateXPos=function(a,b){return b.xPos?b.xPos+=a:b.xPos=e.xPosition(b),b.xPos},this.yPosition=function(a){var b=e.y(e.stackedBars()?e.calculateYPos(e._valueAccessor,a):e._valueAccessor(a));return b},this.groupedBarWidth=function(a){var b=e.barWidth(a),c=e.stackedBars()||1==e.series().length?b:b/e.series().length;return c},this.offsetXPosition=function(a){var b=e.groupedBarWidth(a),c=e.stackedBars()?e.xPosition(a):e.calculateXPos(b,a);return c},this.stackedBars=function(){return e.stacked()||1==this.series().length},this.init=function(){var a=this;this.createChart(),this.initializeAxes(),this.yAxis=d3.svg.axis().scale(this.y).orient("left").tickSize(a.tickSize()).tickPadding(a.tickPadding()).tickFormat(yAxisFormat),this.xAxis=d3.svg.axis().scale(this.x).orient("bottom").tickSize(a.tickSize()).tickPadding(a.tickPadding()).tickFormat(xAxisFormat),this.addClipPath(),this.zoomable()&&this.initZoom(),this.drawAxes(),this.draw()},this.draw=function(a){var b=this;a&&b.redrawAxes()&&this.y.domain([0,d3.round(b.findMax(),1)]).range([this.height()-this.margin().top-this.margin().bottom,0]),this.drawRanges(InsightConstants.Behind),this.drawBars(a),this.drawRanges(InsightConstants.Front),this.drawTargets(a),this.updateAxes()},this.drawAxes=function(){this.chart.append("g").attr("class",InsightConstants.YAxisClass).call(this.yAxis).selectAll("text").attr("class",InsightConstants.AxisTextClass),this.chart.append("g").attr("class",InsightConstants.XAxisClass).attr("transform","translate(0,"+(e.height()-e.margin().bottom-e.margin().top)+")").call(this.xAxis).selectAll("text").attr("class",InsightConstants.AxisTextClass).style("text-anchor","start").attr("transform",InsightConstants.XAxisRotation).attr("dx","10").attr("dy","0").on("mouseover",this.setHover).on("mouseout",this.removeHover).on("click",function(a){return e.filterClick(this,a)})},this.drawRanges=function(a){var b=a?this.ranges().filter(function(b){return b.position==a}):this.ranges();if(b)for(var c in b){this._rangeAccessor=b[c].calculation;var d=b[c].type(this),e="path."+b[c].class,f=this.chart.selectAll(e);this.rangeExists(f)||this.chart.append("path").attr("class",b[c].class).attr("fill",b[c].color),this.chart.selectAll(e).datum(this.dataset(),this.matcher).transition().duration(this.animationDuration).attr("d",d)}},this.rangeExists=function(a){return a[0].length},this.drawBars=function(a){var b=function(a){a.yPos=0,a.xPos=0},c=this.chart.selectAll("g."+InsightConstants.BarGroupClass).data(this.dataset(),this.matcher).each(b),d=c.enter().append("g").attr("class",InsightConstants.BarGroupClass),e=d.selectAll("rect.bar");console.log(this);for(var h in this.series()){this._valueAccessor=this.cumulative()?this.series()[h].cumulative:this.series()[h].calculation,e=d.append("rect").attr("class",this.series()[h].name+"class bar").attr("y",this.yDomain()).attr("height",0).attr("fill",this.series()[h].color).attr("clip-path","url(#clip)").on("mouseover",f).on("mouseout",g),e.append("svg:text").attr("class",InsightConstants.ToolTipTextClass),e.append("svg:text").attr("class",InsightConstants.ToolTipLabelClass);var i=a?0:this.animationDuration,j=c.selectAll("."+this.series()[h].name+"class.bar").transition().duration(i).attr("y",this.yPosition).attr("x",this.offsetXPosition).attr("width",this.groupedBarWidth).attr("height",this.barHeight);j.selectAll("."+InsightConstants.ToolTipTextClass).text(this.tooltipText),j.selectAll("."+InsightConstants.ToolTipLabelClass).text(this.series()[h].label)}},this.updateAxes=function(){var a=this.chart.selectAll("g.x-axis").call(this.xAxis);a.selectAll("text").style("text-anchor","start").attr("transform",InsightConstants.XAxisRotation).attr("dx","10").attr("dy","0").on("mouseover",this.setHover).on("mouseout",this.removeHover).on("click",function(a){return e.filterClick(this,a)}),a.selectAll("text:not(.selected)").attr("class","x-axis axis-text"),this.chart.selectAll(".y-axis").call(this.yAxis).selectAll("text").attr("class","axis-text")},this.drawTargets=function(){if(this.targets()){this._targetAccessor=_targets.calculation;var a=this.chart.selectAll("rect.target").data(this.targetData(),this.matcher),b=a.enter().append("rect").attr("class","target "+_targets.name+"class").on("mouseover",function(){e.mouseOver(e,this)}).on("mouseout",function(){e.mouseOut(e,this)});b.append("svg:text").text(this.targetTooltipText).attr("class",InsightConstants.ToolTipTextClass),b.append("svg:text").text(_targets.label).attr("class",InsightConstants.ToolTipLabelClass),a.transition().duration(this.animationDuration).attr("x",this.targetX).attr("y",this.targetY).attr("width",this.targetWidth).attr("height",4).attr("fill",_targets.color),a.selectAll("."+InsightConstants.ToolTipTextClass).text(this.targetTooltipText).attr("class",InsightConstants.ToolTipTextClass)}}}function TimeLine(a,b,c,d){BaseChart.call(this,a,b,c,d);var e=this;this.maxRange=d3.max(this.dataset(),function(a){return a.value}),this.range=[this.dimension.Dimension.bottom(1)[0].Date,this.dimension.Dimension.top(1)[0].Date],this.brushColor=function(a){return arguments.length?(this._brushColor=a,this):this._brushColor},this.initializeAxes=function(){this.x=d3.time.scale().domain(this.range).rangeRound([0,this.width()]),this.y=d3.scale.linear().domain([0,this.maxRange]).rangeRound([this.yDomain(),0]),this.xAxis=d3.svg.axis().scale(this.x).tickSize(0).orient("bottom")},this.display=function(){var a=this,b=a.brush.extent()[0],c=a.brush.extent()[1],d={name:"timeline",filterFunction:function(a){return a>=b&&c>=a}};String(b)!=String(c)?(this.oldFilter&&this.filterEvent(this.dimension,this.oldFilter),this.filterEvent(this.dimension,d),this.oldFilter=d,a.mini.select(".brush").call(a.brush.extent([b,c]))):this.filterEvent(this.dimension,this.oldFilter)},this.init=function(){this.createChart(),this.initializeAxes(),this.mini=this.chart.append("g").attr("width",this.width()).attr("height",this.yDomain()).attr("class","mini"),this.brush=d3.svg.brush().x(this.x).on("brush",function(){e.display()}),e.mini.append("g").selectAll(".miniItems").data(this.dataset()).enter().append("rect").attr("class","minitems").attr("x",this.xPosition).attr("y",this.yPosition).attr("width",5).attr("height",this.barHeight).attr("fill",e._barColor),e.mini.append("g").attr("class","x axis").attr("transform","translate(0,"+this.yDomain()+")").style("font-size","11px").call(e.xAxis),e.mini.append("g").attr("class","x brush").call(e.brush).selectAll("rect").attr("height",this.yDomain()).attr("fill",e._brushColor).style("opacity","0.5")},this.draw=function(){var a=this;a.chart.selectAll("rect.minitems").data(this.dataset()).transition().duration(a.duration).attr("y",this.yPosition).attr("height",this.barHeight)}}function TimelineChart(a,b,c){BaseChart.call(this,name,a,null,null);var d=this;this.values=c,this.key=b,this.dataset=function(){return this.values},this.longdrag=!1,this.drag=d3.behavior.drag().on("drag",function(){d3.select(this).attr("y",this.y.baseVal.value+d3.event.dy).attr("height",this.height.baseVal.value-d3.event.dy).classed("active",!0)}).on("dragend",function(a){d.updatedEntryHandler.call(this,d.key,a,Math.round(d.y.invert(this.y.baseVal.value))),d3.select(this).classed("active",!1)}),this.updatedEntryHandler=function(){d.draw()},this.newEntryHandler=function(){},this.clickEvent=function(){if(!d.longdrag){var a=d3.mouse(this),b=d.x.invert(a[0]);b=new Date(b.getFullYear(),b.getMonth(),1,1,0,0);var c=Math.round(d.y.invert(a[1]));d.newEntryHandler(d.key,b,c)}clearTimeout(d.timeout),d.longdrag=!1},this.keys=function(){var a=this.dataset().map(function(a){return new Date(a.Date)});return a},this.initializeAxes=function(){this.x=d3.time.scale(),this.y=d3.scale.linear();var a=this.findMax();a=a?a+10:10;this.keys();this.x.domain([new Date(2013,0,1),new Date(2015,0,1)]).range([0,this.xDomain()]),this.y.domain([0,a]).rangeRound([this.yDomain(),0]),this.xAxis=d3.svg.axis().scale(this.x).orient("bottom").tickSize(0).tickPadding(6),this.yAxis=d3.svg.axis().scale(this.y).tickSize(0).orient("left").tickPadding(10),this.zoom=d3.behavior.zoom().on("zoom",this.dragging),this.zoom.x(this.x)},this.dragging=function(){d.timeout=setTimeout(function(){d.longdrag=!0},100),d.draw()},this.init=function(){this.createChart(),this._currentMax=this.findMax(),this.initializeAxes(),$.each(this.dataset(),function(a,b){b.Date=new Date(b.Date)}),this.chart.append("clipPath").attr("id","clip").append("rect").attr("x",0).attr("y",0).attr("width",this.width()).attr("height",this.yDomain()),this.chart.append("g").attr("class","x axis").attr("transform","translate(0,"+(d.height()-d.margin().bottom-d.margin().top)+")"),this.chart.append("g").attr("class","y axis").attr("transform","translate(0,0)"),this.chart.append("rect").attr("class","pane").attr("width",this.width()).attr("height",this.yDomain()).on("click",d.clickEvent).style("fill","none").style("pointer-events","all").call(this.zoom),this.draw()},this.draw=function(){var a=(d.dataset(),d.findMax());a=a?a+10:10,d.y.domain([0,a]),d.chart.select("g.x.axis").call(d.xAxis).selectAll("text").style("font-size","12px"),d.chart.select("g.y.axis").call(d.yAxis).selectAll("text").style("font-size","12px");var b=d.chart.selectAll("rect.item").data(d.dataset()).enter().append("rect").attr("class","item").attr("fill","#ACC3EE");b.append("svg:text").text(this.tooltipText).attr("class","tipValue"),b.append("svg:text").text(this._tooltipLabel).attr("class","tipLabel"),d.chart.selectAll("rect.item").data(d.dataset()).attr("class","item").attr("y",function(a){var b=d.y(d._valueAccessor(a));return b}).attr("height",d.barHeight).attr("x",function(a){var b=d.x(a.Date);return b}).attr("width",function(a){var b=new Date(a.Date.getFullYear(),a.Date.getMonth()+1,1),c=d.x(b)-d.x(a.Date);return c}).on("mouseover",function(){d.mouseOver(d,this)}).on("mouseout",function(){d.mouseOut(d,this)}).attr("clip-path","url(#clip)").call(d.drag).transition().duration(500);this.chart.selectAll("text.tipValue").data(this.dataset()).text(this.tooltipText)}}function PartitionChart(a,b,c,d){this.element=b,this.group=d;var e=1120,f=600,g=d3.scale.linear().range([0,e]),h=d3.scale.linear().range([0,f]);this.vis=d3.select(this.element).append("div").attr("class","chart").style("width",e+"px").style("height",f+"px").append("svg:svg").attr("width",e).attr("height",f),this.partition=d3.layout.partition().children(function(a){return a.values}).value(function(a){return a.ProjectedRevenue}),this.init=function(){function a(a){return"translate(8,"+a.dx*j/2+")"}function b(b){if(b.children){i=(b.y?e-40:e)/(1-b.y),j=f/b.dx,g.domain([b.y,1]).range([b.y?40:0,e]),h.domain([b.x,b.x+b.dx]);var c=d.transition().duration(d3.event.altKey?7500:750).attr("transform",function(a){return"translate("+g(a.y)+","+h(a.x)+")"});c.select("rect").attr("width",b.dy*i).attr("height",function(a){return a.dx*j}),c.select("text").attr("transform",a).style("opacity",function(a){return a.dx*j>12?1:0}),d3.event.stopPropagation()}}var c=this,d=this.vis.selectAll("g").data(c.partition.nodes(this.group())).enter().append("svg:g").attr("transform",function(a){return"translate("+g(a.y)+","+h(a.x)+")"}).on("click",b),i=e/this.group().dx,j=f/1;d.append("svg:rect").attr("width",this.group().dy*i).attr("height",function(a){return a.dx*j}).attr("class",function(a){return a.children?"parent":"child"}).attr("fill","rgb(135, 158, 192)").style("stroke","#fff"),d.append("svg:text").attr("transform",a).attr("dy",".35em").attr("dx","2em").attr("fill","#ecf0f1").style("font-size","13px").style("opacity",function(a){return a.dx*j>12?1:0}).text(function(a){return a.key})}}Group.prototype.filterFunction=function(a){return arguments.length?(this._filterFunction=a,this):this._filterFunction},Group.prototype.cumulative=function(a){return arguments.length?(this._cumulative=a,this):this._cumulative},Group.prototype.getData=function(){var a;return a=this._data.all?this._data.all():this._data,this._filterFunction&&(a=a.filter(this._filterFunction)),a},Group.prototype.getOrderedData=function(){var a;return a=this._data.all?a=this._data.top(1/0).sort(this.orderFunction()):this._data.sort(this.orderFunction()),this._filterFunction&&(a=a.filter(this._filterFunction)),a},Group.prototype.computeFunction=function(a){return this._ordered=!0,arguments.length?(this._compute=a,this):this._compute},Group.prototype.orderFunction=function(a){return arguments.length?(this._orderFunction=a,this):this._orderFunction},Group.prototype.compute=function(){this._compute()},Group.prototype.valueAccessor=function(a){return arguments.length?(this._valueAccessor=a,this):this._valueAccessor},Group.prototype.calculateTotals=function(){if(this._cumulative){var a={},b=0,c=this,d=this._ordered?this.getOrderedData():this.getData();d.forEach(function(d){var e=c._valueAccessor(d);if("object"!=typeof e)b+=e,d.Cumulative=b;else for(var f in e){var g=f+"Cumulative";a[g]?(a[g]+=e[f],e[g]=a[g]):(a[g]=e[f],e[g]=a[g])}})}return this},SimpleGroup.prototype=Object.create(Group.prototype),SimpleGroup.prototype.constructor=SimpleGroup,SimpleGroup.prototype.getOrderedData=function(){return this._data.sort(this._orderFunction)},SimpleGroup.prototype.getData=function(){return this._data},NestedGroup.prototype=Object.create(Group.prototype),NestedGroup.prototype.constructor=NestedGroup,NestedGroup.prototype.getData=function(){return this._nestedData},NestedGroup.prototype.updateNestedData=function(){this._data=this._dimension.Dimension.bottom(1/0),this._nestedData=this._nestFunction.entries(this._data)},NestedGroup.prototype.getOrderedData=function(){return this._nestedData};var Dimension=function(a,b,c,d){this.Dimension=c,this.Name=a,this.Filters=[],this.Function=b,this.displayFunction=d?d:function(a){return a},this.comparer=function(a){return a.Name==this.Name}.bind(this)},InsightFormatters=function(a){var b={};return b.moduleProperty=1,b.currencyFormatter=function(b){var c=a.format(",f");return"Â£"+c(b)},b.dateFormatter=function(b){var c=a.time.format("%b %Y");return c(b)},b}(d3),InsightConstants=function(){var a={};return a.Behind="behind",a.Front="front",a.AxisTextClass="axis-text",a.YAxisClass="y-axis",a.XAxisClass="x-axis",a.XAxisRotation="rotate(90)",a.ToolTipTextClass="tipValue",a.ToolTipLabelClass="tipLabel",a.BarGroupClass="bargroup",a}(),ChartGroup=function(a){this.Name=a,this.Charts=[],this.Dimensions=[],this.FilteredDimensions=[],this.Groups=[],this.CumulativeGroups=[],this.ComputedGroups=[],this.LinkedCharts=[],this.NestedGroups=[]};ChartGroup.prototype.initCharts=function(){this.Charts.forEach(function(a){a.init()})},ChartGroup.prototype.addChart=function(a){return a.filterEvent=this.chartFilterHandler.bind(this),a.triggerRedraw=this.redrawCharts.bind(this),this.Charts.push(a),a},ChartGroup.prototype.addDimension=function(a,b,c,d){var e=new Dimension(b,c,a.dimension(c),d);return this.Dimensions.push(e),e},ChartGroup.prototype.compareFilters=function(a){return function(b){return String(b.name)==String(a.name)}},ChartGroup.prototype.chartFilterHandler=function(a,b){var c=this;if(b){var d=this.Dimensions.filter(a.comparer),e=this.FilteredDimensions.filter(a.comparer);e.length||this.FilteredDimensions.push(a);var f=this.compareFilters(b);d.map(function(a){var d=a.Filters.filter(f).length;d?c.removeMatchesFromArray(a.Filters,f):a.Filters.push(b),0===a.Filters.length?(c.removeItemFromArray(c.FilteredDimensions,a),a.Dimension.filterAll()):a.Dimension.filter(function(b){var c=a.Filters.map(function(a){return a.filterFunction(b)});return c.filter(function(a){return a}).length})}),this.NestedGroups.forEach(function(a){a.updateNestedData()}),this.ComputedGroups.forEach(function(a){a.compute()}),this.CumulativeGroups.forEach(function(a){a.calculateTotals()}),this.redrawCharts()}},ChartGroup.prototype.redrawCharts=function(){for(var a=0;a<this.Charts.length;a++)this.Charts[a].draw()},ChartGroup.prototype.aggregate=function(a,b){var c;if(b instanceof Array)c=this.multiReduceSum(a,b),this.Groups.push(c);else{var d=a.Dimension.group().reduceSum(b);c=new Group(d),this.Groups.push(c)}return c},ChartGroup.prototype.addSumGrouping=function(a,b){var c=a.Dimension.group().reduceSum(b),d=new Group(c);return this.Groups.push(d),d},ChartGroup.prototype.addCustomGrouping=function(a){return this.Groups.push(a),a.cumulative()&&this.CumulativeGroups.push(a),a},ChartGroup.prototype.multiReduceSum=function(a,b){var c=a.Dimension.group().reduce(function(a,c){for(var d in b)c.hasOwnProperty(b[d])&&(a[b[d]]+=c[b[d]]);return a},function(a,c){for(var d in b)c.hasOwnProperty(b[d])&&(a[b[d]]-=c[b[d]]);return a},function(){var a={};for(var c in b)a[b[c]]=0;return a}),d=new Group(c);return d},ChartGroup.prototype.multiReduceCount=function(a,b){var c=a.Dimension.group().reduce(function(a,c){return a.hasOwnProperty(c[b])?a[c[b]]+=1:a[c[b]]=1,a.Total+=1,a},function(a,c){return c.hasOwnProperty(properties[b])&&(a[c[b]]-=1),a.Total--,a},function(){return{Total:0}}),d=new Group(c);return this.Groups.push(d),d},ChartGroup.prototype.removeMatchesFromArray=function(a,b){var c=this,d=a.filter(b);d.forEach(function(b){c.removeItemFromArray(a,b)})},ChartGroup.prototype.removeItemFromArray=function(a,b){var c=a.indexOf(b);c>-1&&a.splice(c,1)};var BaseChart=function(a,b,c,d){var e=this;this.element=b,this.dimension=c,this.group=d,this._name=a;var f=d3.functor(a);this.x=d3.scale.ordinal(),this.y=d3.scale.linear(),this._keyAccessor=function(a){return a.key},this._valueAccessor=function(a){return a.value};var g=d3.functor(300),h=d3.functor(300),i=d3.functor(!1),j=d3.functor(!1),k=d3.functor(!1),l=d3.functor(.2),m=d3.functor(20),n=d3.functor("11px"),o=d3.functor(!1),p=d3.functor(!1),q=d3.functor("blue"),r=d3.functor(!1),s=d3.functor(0),t=d3.functor(10),u=d3.functor("Value");this._currentMax=0,this.isFiltered=!1,this.duration=400,this.filters=[],this._linkedCharts=[],this._xRangeType=this.x.rangeRoundBands,this._yRangeType=this.y.range,this._barWidthFunction=this.x.rangeBand,this._margin={top:0,bottom:0,left:0,right:0},this._defaultSeries={name:"default",label:function(){return e.tooltipLabel()},calculation:e._valueAccessor,color:function(a){return q(a)}};var v=[this._defaultSeries],w=null,x=[];this._targetAccessor=function(a){return a.value},this.matcher=function(a){return e._keyAccessor(a)},this._rangeAccessor=function(a){return a.value},this._limitFunction=function(){return!0},this._labelAccessor=function(a){return a.key},this._tooltipFormat=function(a){return a},yAxisFormat=function(a){return a},xAxisFormat=function(a){return a},this.xPosition=function(a){var b=Math.round(e._barWidthFunction==e.x.rangeBand||e._barWidthFunction==e.x.rangeRound?0:e.barWidth(a)/2);return e.x(e._keyAccessor(a))-b},this.yPosition=function(a){return e.y(e._valueAccessor(a))},this.rangeY=function(a){return e.y(e._rangeAccessor(a))},this.animationDuration=function(a,b){return e.duration+b},this.rangeX=function(a,b){var c=b==e.keys().length-1?e._barWidthFunction(a):0;return e.x(e._keyAccessor(a))+c},this.barHeight=function(a){return e.height()-e.margin().top-e.margin().bottom-e.y(e._valueAccessor(a))},this.targetY=function(a){return e.y(e._targetAccessor(a))},this.targetX=function(a){var b=e._barWidthFunction==e.x.rangeBand?0:e.barWidth(a)/2;return e.x(e._keyAccessor(a))+e._barWidthFunction(a)/3-b},this.targetWidth=function(a){return e._barWidthFunction(a)/3},this.targetTooltipText=function(a){return e._tooltipFormat(e._targetAccessor(a))},this.tooltipText=function(a){return e._tooltipFormat(e._valueAccessor(a))},this.yDomain=function(){return e.height()-e.margin().top-e.margin().bottom},this.xDomain=function(){return e.width()-e.margin().left-e.margin().right},this.xBounds=function(){var a=this.invert()?this.margin().right:this.margin().left,b=this.width()-(this.margin().right+this.margin().left);return{start:a,end:b}},this.yBounds=function(){var a=this.invert()?this.margin().top:this.margin().bottom,b=this.height()-(this.margin().top+this.margin().bottom);return{start:a,end:b}},this.createChart=function(a){return a||d3.select(this.element).append("div").attr("class","title").text(this._displayName),this.chart=d3.select(this.element).append("svg").attr("class","chart"),this.chart.attr("width",this.width()).attr("height",this.height()),this.chart=this.chart.append("g").attr("transform","translate("+this.margin().left+","+this.margin().top+")"),this.applyOrderableHeader(),this.tooltip(),this.chart},this.calculateBarColor=function(a){return q(a)},this.zoomable=function(a){return arguments.length?(this._zoomable=a,this):this._zoomable},this.displayName=function(a){return arguments.length?(f=d3.functor(a),this):f()},this.tickSize=function(a){return arguments.length?(s=d3.functor(a),this):s()},this.tickPadding=function(a){return arguments.length?(t=d3.functor(a),this):t()},this.width=function(a){return arguments.length?(h=d3.functor(a),this):h()},this.height=function(a){return arguments.length?(g=d3.functor(a),this):g()},this.orderable=function(a){return arguments.length?(p=d3.functor(a),this):p()},this.ordered=function(a){return arguments.length?(o=d3.functor(a),this):o()},this.orderChildren=function(a){return arguments.length?(this._orderChildren=a,this):this._orderChildren},this.initZoom=function(){this.zoom=d3.behavior.zoom().on("zoom",this.dragging.bind(this)),this.zoom.x(this.x),this.chart.append("rect").attr("class","pane").attr("width",this.width()).attr("height",this.yDomain()).on("click",e.clickEvent).style("fill","none").style("pointer-events","all").call(this.zoom)},this.addClipPath=function(){this.chart.append("clipPath").attr("id","clip").append("rect").attr("x",0).attr("y",0).attr("width",this.width()).attr("height",this.yDomain())},this.dragging=function(){this.draw(!0)},this.setXAxisRange=function(a){return this._xRangeType=a(this.x),this},this.initializeAxes=function(){this.initializeXAxis(this),this.initializeYAxis(this)},this.xDomainRange=function(){return this.keys()},this.xRange=function(a){return arguments.length?(this.xDomainRange=a,this):this.xDomainRange()},this.initializeYAxis=function(a){this.applyYAxisRange.call(a.y.domain([0,a.findMax()]),a,a._yRangeType)},this.initializeXAxis=function(a){this.applyXAxisRange.call(a.x.domain(a.xDomainRange()),a,a._xRangeType)},this.applyXAxisRange=function(a,b){b.apply(this,[[0,a.xDomain()],a.barPadding()])},this.applyYAxisRange=function(a,b){b.apply(this,[[a.yDomain(),0],0])},this.link=function(a,b){return-1==this._linkedCharts.indexOf(a)&&(this._linkedCharts.push(a),b&&this._linkedCharts.forEach(function(b){b.link(a,!1)})),this},this.cumulative=function(a){return arguments.length?(j=d3.functor(a),this):j()},this.xAxisFormat=function(a){return arguments.length?(e._xAxisFormat=a,this):e._xAxisFormat},this.updateMax=function(a){var b,c=0;for(var d in this.series())b=this.cumulative()?this.series()[d].cumulative:this.series()[d].calculation,c+=b(a),this._currentMax=c>this._currentMax?c:this._currentMax;if(this.ranges().length)for(var e in this.ranges())b=this.ranges()[e].calculation,c=b(a),this._currentMax=c>this._currentMax?c:this._currentMax;return this._currentMax},this.targetMax=function(a){var b=0;return w&&(func=this.cumulative()?w.cumulative:w.calculation,b=func(a),this._currentMax=b>this._currentMax?b:this._currentMax),this._currentMax},this.findMax=function(){var a=this,b=d3.max(this.dataset(),function(b){return a.updateMax(b)});if(w){var c=d3.max(w.data.getData(),function(b){return a.targetMax(b)});b=b>c?b:c}return this.maxUpdatedEvent(b),b},this.zeroValueEntry=function(a){var b,c=0;if(this.series().length)for(var d in this.series())b=this.cumulative()?this.series()[d].cumulative:this.series()[d].calculation,c|=Math.round(b(a),1)>0;else c|=Math.round(this._valueAccessor(a),1)>0;return w&&(b=this.cumulative()?w.cumulative:w.calculation,c|=Math.round(b(a),1)>0),c},this.keys=function(){var a=this,b=[];return b=this.redrawAxes()?this.dataset().filter(function(b){return a.zeroValueEntry(b)}).map(this._keyAccessor):this.dataset().map(this._keyAccessor)},this.series=function(a){return arguments.length?(v=a,this):v},this.stacked=function(a){return arguments.length?(i=d3.functor(a),this):i()},this.targets=function(a){return arguments.length?(w=a,this):w},this.ranges=function(a){return arguments.length?(x=a,this):x},this.toggleSortIcon=function(){var a=this;a.ordered()?d3.select(a.element).select(".fa-arrow-up").style("display","inline-block"):d3.select(a.element).select(".fa-arrow-up").style("display","none")},this.titleClicked=function(){this.ordered(!this.ordered()),this.toggleSortIcon.call(this),this.draw()},this.applyOrderableHeader=function(){if(this.orderable()){var a=this.ordered()?"inline-block":"none";d3.select(this.element).select("div.title").style("cursor","pointer").on("click",this.titleClicked.bind(this)).append("div").attr("class","order-icon fa fa-arrow-up").style("display",a)}},this.topResults=function(a){return arguments.length?(this._topResults=a,this):this._topResults},this.dataset=function(){var a=this.ordered()?this.group.getOrderedData():this.group.getData();return a.filter(this._limitFunction)},this.targetData=function(){return w.data.getData().filter(this._limitFunction)},this.keyAccessor=function(a){return arguments.length?(this._keyAccessor=a,this):this._keyAccessor},this.labelAccessor=function(a){return arguments.length?(this._labelAccessor=a,this):this._labelAccessor},this.tooltipFormat=function(a){return arguments.length?(this._tooltipFormat=a,this):this._tooltipFormat},this.barPadding=function(a){return arguments.length?(l=d3.functor(a),this):l()},this.yAxisFormat=function(a){return arguments.length?(yAxisFormat=a,this):yAxisFormat},this.valueAccessor=function(a){return arguments.length?(this._valueAccessor=a,this._defaultSeries.calculation=a,this):this._valueAccessor},this.redrawAxes=function(a){return arguments.length?(k=d3.functor(a),this):k()},this.margin=function(a){return arguments.length?(this._margin=a,this):this._margin},this.setXAxis=function(a){return arguments.length?(this.x=a,this):this.x},this.invert=function(a){return arguments.length?(r=d3.functor(a),this):r()},this.setHover=function(){d3.select(this).classed("active",!0)},this.removeHover=function(){d3.select(this).classed("active",!1)},this.mouseOver=function(a,b){if(a.hasTooltip){var c=$(b).find(".tipValue").first().text(),d=$(b).find(".tipLabel").first().text();a.tip.show({label:d,value:c})}d3.select(b).classed("active",!0)},this.mouseOut=function(a,b,c){a.hasTooltip&&a.tip.hide(c),d3.select(b).classed("active",!1)},this.isFunction=function(a){var b={};return a&&"[object Function]"===b.toString.call(a)},this.labelColor=function(a){return arguments.length?(this._labelColor=a,this):this._labelColor},this.barColor=function(a){return arguments.length?(q=d3.functor(a),this):q()},this.tooltipLabel=function(a){return arguments.length?(u=d3.functor(a),this):u()},this.tooltip=function(){return this.hasTooltip=!0,this.tip=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(a){return"<span class='tiplabel'>"+a.label+": </span><span class='tipvalue'>"+a.value+"</span>"}),this.chart.call(this.tip),this},this.filterKey=function(){},this.limit=function(a){return arguments.length?(this._limitFunction=a,this):this._limitFunction},this.labelPadding=function(a){return arguments.length?(m=d3.functor(a),this):m()},this.labelFontSize=function(a){return arguments.length?(n=d3.functor(a),this):n()},this.labelAnchoring=function(){return this.invert()?"end":"start"},this.filterFunction=function(a,b){var c=a.key?a.key:a;return{name:c,element:b,filterFunction:function(a){return String(a)==String(c)}}},this.draw=function(){},this.init=function(){},this.triggerRedraw=function(){},this.filterEvent=function(){},this.updateTargets=function(){},this.drawTargets=function(){},this.maxUpdatedEvent=function(a){this._linkedCharts.forEach(function(b){b._currentMax=b._currentMax<a?a:b._currentMax})},this.filterClick=function(a,b){if(this.dimension){var c=this.filterFunction(b,a);this.filterEvent(this.dimension,c)}},this.barWidth=function(a){return e._barWidthFunction(a)}};Legend.prototype=Object.create(BaseChart.prototype),Legend.prototype.constructor=Legend,DataTable.prototype=Object.create(BaseChart.prototype),DataTable.prototype.constructor=DataTable,BarChart.prototype=Object.create(BaseChart.prototype),BarChart.prototype.constructor=BarChart;var MultipleChart=function(a,b,c,d,e){BaseChart.call(this,a,b,c,d),this._chartGroup=e;var f=this;this.x=d3.scale.linear(),this.y=d3.scale.ordinal(),this.yAxis=d3.svg.axis().scale(this.y).orient("left").tickSize(f.tickSize()).tickPadding(10),this.xAxis=d3.svg.axis().scale(this.x).orient("bottom").tickSize(f.tickSize()).tickPadding(10).tickFormat(function(a){return f.xFormatFunc(a)}),this.initializeAxes=function(){this.x.domain([0,this.findMax()]).range([0,this.xBounds().end]),this.y.domain(this.keys()).rangeRoundBands([0,this.yDomain()],.2)},this.rowWidth=function(a){return this.x(this._valueAccessor(a))}.bind(this),this.yPosition=function(a){return this.y(a.key)}.bind(this),this.rowHeight=function(){return this.y.rangeBand()}.bind(this),this.barXPosition=function(a){var b=0;return this.invert()&&(b=this.xBounds().end-this.x(this._valueAccessor(a))),b}.bind(this),this.subChartName=function(a){return"sub"+f._name.replace(/ /g,"_")+a.replace(/\s/g,"")},this.createChart=function(){return this.chart=d3.select(this.element).append("div").attr("class","chart multiChart"),this.chart.append("div").attr("class","title").text(this._displayName),this.chart
},this.subCharts=[],this.init=function(){this.createChart();var a=this.chart.selectAll("div.subchart").data(this.dataset());a.enter().append("div").attr("class","subchart").attr("id",function(a){return f.subChartName(f._keyAccessor(a))}),this.dataset().forEach(function(a){var b=[],c=f.dimension.Dimension.group().reduceCount().all().map(f._keyAccessor);c.forEach(function(c){var d={key:c},e=$.grep(a.values,function(a){return a.key==c}),g=e.length?f._valueAccessor(e[0]):0;d.values=g,b.push(d)});var d=new SimpleGroup(b),e="#"+f.subChartName(a.key),g=new RowChart(a.key,e,f.dimension,d,f._chartGroup).width(300).height(300).tooltipLabel(f._tooltipLabel).tooltipFormat(f._tooltipFormat).ordered(f._orderChildren).valueAccessor(function(a){return a.values}).margin({left:120,top:0,bottom:0,right:0});f.subCharts.push(g),f._chartGroup.addChart(g),g.init()})},this.draw=function(){var a=(this.chart.selectAll("div.subchart").data(this.dataset()),this.dataset());this.subCharts.forEach(function(b){var c=$.grep(a,function(a){return a.key==b.displayName()});c=c.length?b._valueAccessor(c[0]):[],b.group.getData().forEach(function(a){var b=$.grep(c,function(b){return b.key==a.key})[0];a.values=b?b.values:0})})}};MultipleChart.prototype=Object.create(BaseChart.prototype),MultipleChart.prototype.constructor=MultipleChart,TimeLine.prototype=Object.create(BaseChart.prototype),TimeLine.prototype.constructor=TimeLine,TimelineChart.prototype=Object.create(BaseChart.prototype),TimelineChart.prototype.constructor=TimelineChart;var RowChart=function(a,b,c,d){BaseChart.call(this,a,b,c,d);var e=this;return this.x=d3.scale.linear(),this.y=d3.scale.ordinal(),this.yAxis=d3.svg.axis().scale(this.y).orient("left").tickSize(e.tickSize()).tickPadding(e.tickPadding()),this.xAxis=d3.svg.axis().scale(this.x).orient("bottom").tickSize(e.tickSize()).tickPadding(e.tickPadding()).tickFormat(function(a){return e.xFormatFunc(a)}),this.initializeAxes=function(){this.x.domain([0,this.findMax()]).range([0,this.xBounds().end]),this.y.domain(this.keys()).rangeRoundBands([0,this.yDomain()],.2)},this.rowWidth=function(a){return this.x(this._valueAccessor(a))}.bind(this),this.yPosition=function(a){return this.y(a.key)}.bind(this),this.rowHeight=function(){return this.y.rangeBand()}.bind(this),this.barXPosition=function(a){var b=0;return this.invert()&&(b=this.xBounds().end-this.x(this._valueAccessor(a))),b}.bind(this),this.init=function(){var a=this;this.createChart(),this.initializeAxes(),this.chart.append("g").attr("class","y-axis").call(this.yAxis).selectAll("text").attr("class","row-chart-y").on("mouseover",this.setHover).on("mouseout",this.removeHover).on("click",function(b){a.filterClick(this,b)}),this.draw()},this.draw=function(){var a=this;this.y.domain(this.keys()).rangeRoundBands([0,this.height()],.2),this.chart.selectAll("g.y-axis").call(this.yAxis).selectAll("text").each(function(){d3.select(this).classed("row-chart-y","true")}).on("mouseover",this.setHover).on("mouseout",this.removeHover).on("click",function(b){a.filterClick(this,b)}),a._redrawAxes&&this.x.domain([0,this.findMax()]).range([0,this.xBounds().end]);var b=this.chart.selectAll("rect").data(this.dataset(),this.matcher);b.exit().remove();var c=b.enter().append("rect").attr("x",0).attr("y",this.yPosition).attr("width",0).attr("fill",this.barColor()).attr("height",this.rowHeight).on("mouseover",function(b){a.mouseOver(a,this,b)}).on("mouseout",function(b){a.mouseOut(a,this,b)});c.append("svg:text").attr("class","tipValue"),c.append("svg:text").attr("class","tipLabel");var d=b.transition().duration(this.animationDuration);d.attr("x",this.barXPosition).attr("width",this.rowWidth),b.selectAll("text.tipValue").text(this.tooltipText),b.selectAll("text.tipLabel").text(this._tooltipLabel),(a._redrawAxes||a.orderable())&&d.attr("y",this.yPosition).attr("height",this.rowHeight)},this};RowChart.prototype=Object.create(BaseChart.prototype),RowChart.prototype.constructor=RowChart,PartitionChart.prototype=Object.create(BaseChart.prototype),PartitionChart.prototype.constructor=PartitionChart;